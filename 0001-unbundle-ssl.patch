From fca84371cbc05e052619e8b1ece6103e68d3a0ed Mon Sep 17 00:00:00 2001
From: Igor Gnatenko <i.gnatenko.brain@gmail.com>
Date: Mon, 2 Jan 2017 09:48:13 +0100
Subject: [PATCH 1/2] unbundle ssl

Signed-off-by: Igor Gnatenko <i.gnatenko.brain@gmail.com>
---
 ldap3/core/tls.py | 4 ++--
 setup.py          | 8 +++++++-
 2 files changed, 9 insertions(+), 3 deletions(-)

diff --git a/ldap3/core/tls.py b/ldap3/core/tls.py
index ea702c8..b287855 100644
--- a/ldap3/core/tls.py
+++ b/ldap3/core/tls.py
@@ -38,8 +38,8 @@ except ImportError:
 try:
     from ssl import match_hostname, CertificateError  # backport for python2 missing ssl functionalities
 except ImportError:
-    from ..utils.tls_backport import CertificateError
-    from ..utils.tls_backport import match_hostname
+    from backports.ssl_match_hostname import CertificateError
+    from backports.ssl_match_hostname import match_hostname
     if log_enabled(BASIC):
         log(BASIC, 'using tls_backport')
 
diff --git a/setup.py b/setup.py
index 3ba012a..ca555f1 100644
--- a/setup.py
+++ b/setup.py
@@ -23,6 +23,8 @@
 # along with ldap3 in the COPYING and COPYING.LESSER files.
 # If not, see <http://www.gnu.org/licenses/>.
 
+import sys
+
 from setuptools import setup
 from json import load
 
@@ -39,6 +41,10 @@ status = str(version_dict['status'])
 
 long_description = str(open('README.rst').read())
 
+install_requires = [i.strip() for i in open('requirements.txt').readlines()]
+if sys.version_info < (2, 7, 9):
+    install_requires.append('backports.ssl_match_host_name')
+
 setup(name=package_name,
       version=version,
       packages=['ldap3',
@@ -56,7 +62,7 @@ setup(name=package_name,
                 'ldap3.extend.microsoft',
                 'ldap3.extend.standard'],
       package_dir={'': package_folder},
-      install_requires=[i.strip() for i in open('requirements.txt').readlines()],
+      install_requires=install_requires,
       license=license,
       author=author,
       author_email=email,
-- 
2.11.0

